# Pagora 仕様書

## 1. プロジェクト概要

| 項目 | 内容 |
|------|------|
| プロジェクト名 | Pagora |
| リポジトリ | https://github.com/hipper-gif/Pagora.git |
| 目的 | 社内Wiki・情報管理・議事録・タスク管理のためのNotionライクなツール |
| 対象ユーザー | 社内メンバーのみ（外部公開なし） |

---

## 2. 技術スタック

| 項目 | 採用技術 |
|------|---------|
| フロントエンド | Next.js（TypeScript） |
| ブロックエディタ | Tiptap |
| バックエンド | Next.js API Routes |
| DB | PostgreSQL |
| ORM | Prisma |
| 認証 | NextAuth.js |
| ファイルストレージ | バッファローNAS（社内LAN経由） |
| インフラ | Docker Compose |
| サーバー | Windows PC（Docker Desktop + WSL2） |
| バージョン管理 | GitHub |

---

## 3. 機能一覧

### 3-1. ブロックエディタ

ページ内のコンテンツはすべてブロック単位で管理する。

#### 対応ブロック種別

| ブロック名 | 説明 |
|-----------|------|
| テキスト | 基本の段落テキスト |
| 見出し1 / 2 / 3 | H1〜H3の見出し |
| 箇条書き | 順序なしリスト |
| 番号付きリスト | 順序ありリスト |
| ToDoリスト | チェックボックス付きリスト |
| トグル | 折りたたみ可能なブロック |
| 引用 | 引用テキスト |
| 区切り線 | 水平線 |
| コールアウト | Tips・警告などの強調ブロック（アイコン付き） |
| コードブロック | シンタックスハイライト付き（言語指定可） |
| テーブル | シンプルな表（行・列） |
| 画像 | アップロードまたはURL指定 |
| ファイル | 任意ファイルのアップロード・ダウンロード |

#### テキスト装飾

ボールド、イタリック、下線、取り消し線、インラインコード、文字色、背景色

#### ブロック操作

- `/`コマンドでブロック種別を選択・挿入
- ドラッグ&ドロップでブロックの並び替え
- ブロック単位でのコピー・削除・複製

---

### 3-2. ページ管理

- ページの作成・編集・削除
- ページのネスト（ページの中にページを作成可能、無制限）
- サイドバーでのツリー表示とナビゲーション
- ページアイコンの設定（絵文字）
- ページのゴミ箱・復元機能
- パンくずリスト表示

---

### 3-3. バージョン管理

- 編集中は**10分ごと**に自動スナップショットを保存
- 最後の編集から**2分後**に追加スナップショットを保存
- バージョン一覧の表示（日時・編集者）
- 任意のバージョンへのワンクリック復元
- バージョン間の差分表示（将来対応可）

---

### 3-4. 検索

- ワークスペース全体を横断するキーワード検索
- ページタイトル・本文を対象に検索

---

### 3-5. タスク管理

- ToDoブロックでのチェックボックス管理
- ステータス管理（未着手・進行中・完了）
- 担当者・期日の設定（将来対応可）

---

### 3-6. ファイル管理

- 画像ファイルのアップロード・表示
- 任意ファイル（PDF・Excel等）のアップロード・ダウンロード
- ファイルの保存先：バッファローNAS（社内LAN経由マウント）
- 対応画像形式：JPEG、PNG、GIF、WebP
- ファイルサイズ上限：TBD（運用で決定）

---

### 3-7. ユーザー・権限管理

#### ユーザー管理

- ユーザー登録・ログイン・ログアウト
- 管理者によるユーザー招待・削除

#### 権限レベル

| 権限 | できること |
|------|-----------|
| 管理者 | 全操作 + ユーザー管理 |
| 編集者 | ページの作成・編集・削除 |
| 閲覧者 | ページの閲覧のみ |

#### 認証方式

- メールアドレス＋パスワード（NextAuth.js Credentials）

---

### 3-8. テンプレート

- 議事録テンプレート（初期提供）
- テンプレートからのページ作成
- テンプレートの追加・編集・削除（管理者のみ）

---

### 3-9. Notionインポート

- Notionエクスポート（Markdown & CSV形式）のZIPファイルを受け付ける
- ZIPを解析してページ階層・コンテンツを自動インポート
- Markdownブロックをエディタのブロック形式に変換
- 画像ファイルをNASに自動コピー
- Calloutブロック（HTML形式で出力されるもの）の変換対応

---

### 3-10. 対応環境

- PCブラウザ（Chrome / Edge / Safari / Firefox）
- モバイルブラウザ（レスポンシブデザイン対応）

---

## 4. 画面一覧

| 画面名 | 説明 |
|--------|------|
| ログイン画面 | メール・パスワードでの認証 |
| ワークスペース画面 | サイドバー＋メインエリアの基本レイアウト |
| ページ編集画面 | ブロックエディタ |
| バージョン履歴画面 | バージョン一覧・復元 |
| 検索画面 | キーワード検索・結果表示 |
| 管理画面 | ユーザー管理・権限設定・テンプレート管理 |
| インポート画面 | NotionエクスポートZIPのアップロード |

---

## 5. 非機能要件

| 項目 | 内容 |
|------|------|
| 可用性 | 社内LAN内で常時稼働（Windows PC + Docker） |
| セキュリティ | 社内ネットワーク内のみアクセス可能。データは社内サーバー・NASに保持 |
| データバックアップ | PostgreSQLの定期バックアップ（方針はTBD） |
| 外部通信 | 原則なし（GitHub除く） |

---

## 6. 将来対応（後回し機能）

- コメント・メンション機能
- バージョン間の差分表示
- タスクへの担当者・期日設定
- モバイルアプリ（ネイティブ）

---

## 7. 開発フェーズ

| フェーズ | 内容 |
|---------|------|
| Phase 1（MVP） | 認証・ページ管理・ブロックエディタ・バージョン管理 |
| Phase 2 | 検索・ファイルアップロード・権限管理 |
| Phase 3 | テンプレート・Notionインポート |
| Phase 4 | タスク管理・モバイル最適化 |

---

## 8. インフラ構成

```
[社内PC・スマホ]
      |
   社内LAN
      |
[Windows専用PC]
  Docker Desktop
  ├── Next.js（Pagoraアプリ）
  └── PostgreSQL
      |
[バッファローNAS]（ファイルストレージ）
```

---

*最終更新：2026-02-27*
